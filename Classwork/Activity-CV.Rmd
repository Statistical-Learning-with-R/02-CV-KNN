---
title: "Test and Training Data"
author: "YOUR NAME HERE"
output: html_document
---

```{r, version = "none"}
templar::versions_multilingual(to_jupyter = TRUE)
```


```{r, include = FALSE}
library(tidyverse)
library(tidymodels)
```

```{r, include = FALSE, version = "python"}
library(reticulate)
## You may need the code below if you are working on your home Windows computer:
py_run_string("import os as os")
py_run_string("os.environ['QT_QPA_PLATFORM_PLUGIN_PATH'] = 'C:/Users/kbodwin/Anaconda3/Library/plugins/platforms'")
```

```{python, include = FALSE}
import pandas as pd
from matplotlib import pyplot as plt
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
```

## Code from slides

```{r, message = FALSE}
ins <- read_csv("https://www.dropbox.com/s/bocjjyo1ehr5auz/insurance_costs_1.csv?dl=1")
head(ins)
```

```{r}
lr_mod <- linear_reg() %>%
  set_mode("regression") %>%
  set_engine("lm")
```


```{python}
ins = pd.read_csv("https://www.dropbox.com/s/bocjjyo1ehr5auz/insurance_costs_1.csv?dl=1")
ins.head()
```

```{python}
from sklearn.preprocessing import PolynomialFeatures
from sklearn.model_selection import cross_val_score
from sklearn.model_selection import KFold

lm = LinearRegression()

poly = PolynomialFeatures(degree=20)
x_dat = ins["bmi"].values.reshape(-1,1)
x_dat_20 = poly.fit_transform(x_dat)

poly_mod_1 = lm.fit(x_dat, y = ins[["charges"]])
poly_mod_20 = lm.fit(x_dat_20, y = ins[["charges"]])
```

```{python}
cross_validation = KFold(n_splits=10)

scores_1 = cross_val_score(poly_mod_1, x_dat, ins[["charges"]], scoring="neg_mean_squared_error", cv=cross_validation)

scores_20 = cross_val_score(poly_mod_20, x_dat_20, ins[["charges"]], scoring="neg_mean_squared_error", cv=cross_validation)

scores_1.mean()
scores_20.mean()
```



```{r}
ins_cvs <- vfold_cv(ins, v = 10)

poly_1_cv <- lr_mod %>%
  fit_resamples(charges ~ bmi,
                resamples = ins_cvs)

poly_2_cv <- lr_mod %>%
  fit_resamples(charges ~ poly(bmi, 2),
                resamples = ins_cvs)
```

```{r}
poly_1_cv %>% collect_metrics()

poly_2_cv %>% collect_metrics()
```




## Your turn

Suppose you want to fit a regression that predicts `charges` from `age` and `bmi`.

Consider four models:

* `age` and `bmi` both have polynomial 1
* `age` has polynomial 1, `bmi` has polynomial 2
* `age` has polynomial 2, `bmi` has polynomial 1
* `age` and `bmi` both have polynomial 2


(No interactions term for any model.)


Which model is best according to a **Cross-Validation study** with 10 splits?

